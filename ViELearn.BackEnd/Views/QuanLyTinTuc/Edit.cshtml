@using System.Data
@using ViELearn.BackEnd.Ultilities
@model List<ViELearn.Models.ProjectModels.DanhMucChung>

@{
    ViewBag.Title = "Cập nhật thông tin bài viết";
    Layout = "~/Views/Shared/_Layoutv3.cshtml";
}
@section stylePageLever{
    <link href="/UITheme/assets/global/plugins/select2/css/select2.min.css" rel="stylesheet" type="text/css" />
    <link href="/UITheme/assets/global/plugins/select2/css/select2-bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="/UITheme/assets/global/plugins/bootstrap-multiselect/css/bootstrap-multiselect.css" rel="stylesheet" type="text/css" />
    <link href="/UITheme/assets/global/plugins/bootstrap-summernote/summernote.css" rel="stylesheet" type="text/css" />

    <link href="/UITheme/assets/global/plugins/bootstrap-tagsinput/bootstrap-tagsinput.css" rel="stylesheet" type="text/css" />
    <link href="/UITheme/assets/global/plugins/bootstrap-tagsinput/bootstrap-tagsinput-typeahead.css" rel="stylesheet" type="text/css" />

    <link href="/UITheme/assets/global/plugins/dropzone/dropzone.min.css" rel="stylesheet" type="text/css" />
    <link href="/UITheme/assets/global/plugins/dropzone/basic.min.css" rel="stylesheet" type="text/css" />

    <link href="/UITheme/assets/global/plugins/bootstrap-toastr/toastr.min.css" rel="stylesheet" />
    <link href="~/UITheme/assets/global/plugins/jcrop/css/jquery.Jcrop.min.css" rel="stylesheet" />
    <link href="~/UITheme/assets/pages/css/image-crop.min.css" rel="stylesheet" />
    <link href="~/UITheme/assets/global/plugins/ckeditor/css/custom.css" rel="stylesheet" />
    <style type="text/css">
        .table-scrollable > .table > thead > tr > th {
            white-space: pre-wrap !important;
        }

        #sortable tr {
            cursor: pointer;
        }

        thead > tr > th {
            vertical-align: middle !important;
        }

        thead > tr:not(:first-child) > th {
            font-weight: normal !important;
            font-size: 85% !important;
        }

        .note-editable p {
            margin: 0;
        }

        .dropzone .note {
            border-left: 0 !important
        }

        .dz-preview {
            display: inline-block;
            padding: 6px;
        }

            .dz-preview:hover {
                background-color: #dedcdc;
            }

        .dz-preview-crop {
            background-color: #dedcdc;
        }

        .btn_remove {
            color: #7b7a71;
            background-color: #e4e4e4;
            border-radius: 50%;
            position: absolute;
            cursor: pointer;
            right: -5px;
            z-index: 2;
            top: auto;
        }
        /*.dz-image-preview:hover btn_remove {
            position: absolute;
            cursor: pointer;
            right: 8px;
            z-index: 2;
            opacity: 1;
        }*/
        #cke_editor1 {
            display: none;
        }

        .row_img:after, .row_img:before {
            display: inline;
        }

        #stt {
            width: 10%;
            margin-bottom: 0px;
        }

        .bootstrap-tagsinput .tag {
            display: grid !important;
        }

        @@media (max-width:767px) {



            .btn-group .btn + .btn, .btn-group .btn + .btn-group, .btn-group .btn-group + .btn, .btn-group .btn-group + .btn-group {
                margin-left: 0;
            }

            .note-editable img {
                width: 100% !important;
            }
        }

        .popover {
            z-index: 99999 !important;
        }

        #box-actions {
            margin-left: 20px;
            float: right;
        }

        #text-warring-content {
            padding: 11px 0px 9px;
            float: right;
            display: inline-block;
            font-size: 18px;
            line-height: 18px;
        }

        .btn-hotline {
            padding: 10px;
            background-color: #BD8E2D;
            color: #fff;
            border-radius: 3px;
            cursor: pointer;
            text-align: center;
            margin-top: 6px;
            margin-right: 10px;
        }

        .btn-tuvan {
            padding: 10px;
            background-color: #D80D00;
            color: #fff;
            border-radius: 3px;
            cursor: pointer;
            text-align: center;
            margin-top: 6px;
            margin-right: 10px;
        }

        .show-time {
            color: #FFF;
        }

        .btn-hotline a, .btn-tuvan a {
            color: white;
            font-size: 17px;
        }

        .cke_button__simplebutton_icon {
            background-image: url('/UITheme/assets/global/plugins/ckeditor/plugins/add-circle-blue-512.png') !important;
        }

        .cke_button__superbutton_icon {
            background-size: 25px !important;
        }
    </style>
}
@section scriptMainPageLevel{
    <script src="/UITheme/assets/global/scripts/datatable.js" type="text/javascript"></script>
    <script src="/UITheme/assets/global/plugins/datatables/datatables.min.js" type="text/javascript"></script>
    <script src="/UITheme/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js" type="text/javascript"></script>
    <script src="/UITheme/assets/global/plugins/select2/js/select2.full.min.js" type="text/javascript"></script>
    <script src="/UITheme/assets/global/plugins/bootstrap-multiselect/js/bootstrap-multiselect.js" type="text/javascript"></script>
    @*<script src="/UITheme/assets/global/plugins/ckeditor/ckeditor.js"></script>
        <script src="/UITheme/assets/global/plugins/ckeditor/config.js"></script>*@
    <script src="/UITheme/assets/global/plugins/bootstrap-summernote/summernote.min.js" type="text/javascript"></script>

    <script src="/UITheme/assets/global/plugins/bootstrap-tagsinput/bootstrap-tagsinput.min.js" type="text/javascript"></script>
    <script src="/UITheme/assets/global/plugins/typeahead/handlebars.min.js" type="text/javascript"></script>
    <script src="/UITheme/assets/global/plugins/typeahead/typeahead.bundle.min.js" type="text/javascript"></script>
    <script src="/UITheme/assets/global/plugins/dropzone/dropzone.min.js" type="text/javascript"></script>
    <script src="/UITheme/assets/global/plugins/bootstrap-toastr/toastr.min.js"></script>
    <script src="/UITheme/assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js" type="text/javascript"></script>
    <script src="/Scripts/moment-with-locales.js"></script>
    <script src="/Scripts/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
    <script src="/Scripts/clockpicker.js"></script>

}
@section scriptConfigPageLevel{
    <script src="~/UITheme/assets/global/plugins/jcrop/js/jquery.Jcrop.min.js"></script>
    @*<script src="/UITheme/assets/Front-end/js/js.cookie-2.2.0.min.js"></script>*@
    <script type="text/javascript">


        function setusethumbnail(itm) {
            //   alert(1);
            $('.dz-preview').each(function () {
                $(this).removeClass('dz-preview-crop');
            });
            $(itm).parent().addClass('dz-preview-crop');
            var src = $(itm).attr('src');
            $('#thumb_url').val(src);
            //$('#img-crop1').attr('src',src)
            $('#pop-crop-1').data('src', src);
            //console.log(src)
            $('#pop-crop-1').css('display', '');


        }
        function ChangeBakground(itm) {
            $('table').find('tr').each(function () {
                $(this).css('background-color', 'white');
            });
            $(itm).parents().parents('tr').css('background-color', 'yellow');
            $(itm).addClass('');
        }
        $(document).ready(function () {
            $('.summernote').summernote({
                tabsize: 2,
                height: 400
            });
            //$(".date-picker").datepicker('setDate', 'today');
            //$("#cates").val($.cookie('catesId'));

            $("#cboFilter,#cates").select2();
              $('#btnSearch1').click(function () {
                load();
            });
            $('#btnSearch').click(function () {
                load();
              });

            //setInterval(SaveNewsHistory, 30000);
            sortable();
          //  $('.summernote').summernote({ height: 700 });



            function ChangeBakground(itm) {
                $('table').find('tr').each(function () {
                    $(this).css('background-color', 'white');
                });
                $(itm).parents('tr').css('background-color', 'yellow');
                $(itm).addClass('');
            }

            $("#Link-ds").each(function (index) {
                $(this).on("click", function () {
                    // For the boolean value

                    alert(1);
                });
            });


            $('.mt-multiselect').each(function () {
                var btn_class = $(this).attr('class');
                var clickable_groups = ($(this).data('clickable-groups')) ? $(this).data('clickable-groups') : false;
                var collapse_groups = ($(this).data('collapse-groups')) ? $(this).data('collapse-groups') : false;
                var drop_right = ($(this).data('drop-right')) ? $(this).data('drop-right') : false;
                var drop_up = ($(this).data('drop-up')) ? $(this).data('drop-up') : false;
                var select_all = ($(this).data('select-all')) ? $(this).data('select-all') : false;
                var width = ($(this).data('width')) ? $(this).data('width') : '';
                var height = ($(this).data('height')) ? $(this).data('height') : '';
                var filter = ($(this).data('filter')) ? $(this).data('filter') : false;

                // advanced functions
                var onchange_function = function (option, checked, select) {
                    alert('Changed option ' + $(option).val() + '.');
                }
                var dropdownshow_function = function (event) {
                    alert('Dropdown shown.');
                }
                var dropdownhide_function = function (event) {
                    alert('Dropdown Hidden.');
                }

                // init advanced functions
                var onchange = ($(this).data('action-onchange') == true) ? onchange_function : '';
                var dropdownshow = ($(this).data('action-dropdownshow') == true) ? dropdownshow_function : '';
                var dropdownhide = ($(this).data('action-dropdownhide') == true) ? dropdownhide_function : '';

                // template functions
                // init variables
                var li_template;
                if ($(this).attr('multiple')) {
                    li_template = '<li class="mt-checkbox-list"><a href="javascript:void(0);"><label class="mt-checkbox"> <span></span></label></a></li>';
                } else {
                    li_template = '<li><a href="javascript:void(0);"><label></label></a></li>';
                }

                // init multiselect
                $(this).multiselect({
                    nonSelectedText: ' -- Mời chọn -- ',
                    nSelectedText: ' được chọn',
                    showSearch: true,
                    searchText: 'Tìm, lọc',
                    enableClickableOptGroups: clickable_groups,
                    enableCollapsibleOptGroups: collapse_groups,
                    disableIfEmpty: true,
                    enableFiltering: filter,
                    includeSelectAllOption: select_all,
                    dropRight: drop_right,
                    buttonWidth: width,
                    maxHeight: height,
                    onChange: onchange,
                    onDropdownShow: dropdownshow,
                    onDropdownHide: dropdownhide,
                    buttonClass: btn_class,
                    //optionClass: function(element) { return "mt-checkbox"; },
                    //optionLabel: function(element) { console.log(element); return $(element).html() + '<span></span>'; },
        			/*templates: {
		                li: li_template,
		            }*/
                });
            });

            var tags = new Bloodhound({
                datumTokenizer: Bloodhound.tokenizers.obj.whitespace('name'),
                queryTokenizer: Bloodhound.tokenizers.whitespace,
                prefetch: {
                    //url: '/UITheme/typeahead_countries.json',
                    url: '/QuanLyTinTuc/DanhSachTags',
                    filter: function (list) {
                        return $.map(list, function (tagname) {
                            return { name: tagname };
                        });
                    }
                }
            });

            tags.initialize();
            $('#typeahead_tags').tagsinput({
                typeaheadjs: {
                    name: 'tags',
                    displayKey: 'name',
                    valueKey: 'name',
                    source: tags.ttAdapter()
                }
            });
            $('#seo_keywords').tagsinput({});
          //  editor = CKEDITOR.replace('noidung');
        });

        Dropzone.autoDiscover = false;
        $("#frm_dropzone").dropzone({
            url: "/QuanLyTinTuc/UploadFile?id=@ViewBag.Id",
            acceptedFiles: "image/jpeg,image/png,image/gif",
            resizeWidth: 1280,
            resizeHeight: 1280,
            maxFilesize: 0.5,
            resizeMethod: 'contain',
            resizeMimeType: 'image/jpeg,image/png,image/gif',
            init: function () {
                this.on("complete", function (file) {
                    //console.log('one uploaded');
                    //console.log(file.name);
                    var fileName = file.name;
                    var cropImg = '';
                    var html = '';
                    html += ' <div class="col-md-3" style="height:80px;padding-top:5px;padding-bottom:5px;margin-top:5px;margin-bottom:5px;">' +
                        '<div  style="cursor:pointer;position:relative;display: inline!important">' +
                        '<i onclick="removeImg(this)" class="fa fa-times btn_remove" aria-hidden="true"></i>' +
                        '<div class="dz-preview dz-processing dz-image-preview dz-success dz-complete">' +
                        '<img onclick="setusethumbnail(this)" style="max-height:80px;max-width:120px;cursor:pointer;" data-dz-thumbnail="" src="/UserData/@ViewBag.userId/@ViewBag.Id/' + fileName + '" />' +
                        '</div>' +
                        '</div>' + '</div>';

                    if (file.type != "image/jpeg" && file.type != "image/png" && file.type != "image/png" && file.type != "image/gif") {
                        toastr.error("Định dạng ảnh không đúng,xin mời chọn lại đúng file ảnh!");
                    }
                    else {
                        if (file.size < 500000) {
                            $('.modal-body .item-img .row').prepend(html);
                        }
                        else {
                            toastr.error("Dung lượng ảnh đã vượt quá 500Kb,xin mời chọn ảnh lại ảnh!");
                        }
                    }

                    if (this.getUploadingFiles().length === 0 && this.getUploadingFiles().length === 0) {
                        //doSomething();
                        //console.log('all file uploaded');
                    }
                });
            }
        });
        toastr.options = {
            "closeButton": true,
            "debug": false,
            "positionClass": "toast-bottom-right",
            "onclick": null,
            "showDuration": "1000",
            "hideDuration": "1000",
            "timeOut": "5000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        };
         $("#frm_dropzone2").dropzone({
             url: "/QuanLyTinTuc/UploadFileAttack?id=@ViewBag.Id",
             acceptedFiles: "application/pdf,text/plain,.xls,.xlsx,.doc,.docx",
            maxFilesize: 12, // MB
            resizeWidth: 1280,
            resizeHeight: 1280,
            resizeMethod: 'contain',
            resizeMimeType: 'application/pdf,text/plain,.xls,.xlsx,.doc,.docx',
            init: function () {
                this.on("complete", function (file) {
                    var fileName = file.name;
                    var html = ' <tr><td width="80%" class="c-file">' + fileName +'</td><td class="text-center" width="20%"><a onclick="removeFile(this)"  href="Javascript:void(0)"><i class="fa fa-trash font-red"></i></a></td> </tr>';
                    $('.tabl-attack').append(html);
                        if (this.files.length > 4) {
                         console.log('quá số file');
                          $(".btn-file").prop('disabled', true);
                         }
                    if (this.getUploadingFiles().length === 0 && this.getUploadingFiles().length === 0) {
                        //doSomething();
                        //console.log('all file uploaded');
                    }
                    $('#full-width2 .close').click();
                });
            }
        });

        function CropImages(itm) {
            //alert(2);
            //console.log($("#crop_x").val());
            //console.log($("#crop_y").val());
            //console.log($("#crop_w").val());
            //console.log($("#crop_h").val());
            $('.dz-preview').each(function () {
                $(this).removeClass('dz-preview-crop');
            });
            $.ajax({
                data: {
                    x: $("#crop_x").val(),
                    y: $("#crop_y").val(),
                    w: $("#crop_w").val(),
                    h: $("#crop_h").val(),
                    path: $("#crop_Path").val()
                },
                type: 'POST',
                datatype: 'json',
                url: '/QuanLyTinTuc/SaveImageCrop?id=@ViewBag.Id',
                success: function (responsive) {
                    // bootbox.alert("Xóa thành công");
                   var html = '';
                    html += ' <div class="col-md-3" style="height:80px;padding-top:5px;padding-bottom:5px;margin-top:5px;margin-bottom:5px;">' +
                        '<div  style="cursor:pointer;position:relative;display: inline!important">' +
                        '<i onclick="removeImg(this)" class="fa fa-times btn_remove" aria-hidden="true"></i>' +
                        '<div class="dz-preview-crop dz-preview dz-processing dz-image-preview dz-success dz-complete">' +
                        '<img onclick="setusethumbnail(this)" style="max-height:80px;max-width:120px;cursor:pointer;" data-dz-thumbnail="" src="' + responsive.path + '" />' +
                        '</div>' +
                        '</div>' + '</div>';
                    $('.modal-body .item-img .row').prepend(html);
                   //$('.dz-preview').addClass('dz-preview-crop');
                }
            });
        }

        function removeImg(item) {
           // alert(1);
           var url = $(item).parent().find('img').attr('src');
            //console.log(url);
            $.ajax({
                data: { fName: url },
                url: '/QuanLyTinTuc/DeleteFile',
                success: function (responsive) {
                    // bootbox.alert("Xóa thành công");
                    $(item).parent().parent().remove();
                }
            });
        }
        @*function removeFile(item) {
            var url = $(item).parent().parent().find('.c-file').text();
            console.log($(item).parent().parent()); return;
            $.ajax({
                data: { fName: url,id:@ViewBag.Id },
                url: '/QuanLyTinTuc/DeleteFileAttack',
                success: function (responsive) {
                    // bootbox.alert("Xóa thành công");
                    $(item).parent().parent().remove();
                }
            });
        }*@
        function removeFile(item) {
            //alert(id);
            var url = $(item).parent().parent().find('.c-file').text();
            bootbox.confirm({
                message: "Bạn có chắc chắn muốn xóa không?",
                buttons: {
                    cancel: {
                        label: 'Không',
                        className: 'btn-info'
                    },
                    confirm: {
                        label: 'Có',
                        className: 'btn-danger'
                    }
                },
                callback: function (result) {
                    if (result) {
                        $.ajax({
                            data: { fName: url,id:@ViewBag.Id },
                            url: '/QuanLyTinTuc/DeleteFileAttack',
                            success: function (responsive) {
                                    $(item).parent().parent().remove();
                            },
                            error: function (responsive) {
                                bootbox.alert("Có lỗi xảy ra!");
                            }
                        });
                    }
                }
            });
        }

        function removeNews(itm) {
                     bootbox.confirm({
                message: "Bạn có chắc chắn muốn xóa không?",
                buttons: {
                    cancel: {
                        label: 'Không',
                        className: 'btn-info'
                    },
                    confirm: {
                        label: 'Có',
                        className: 'btn-danger'
                    }
                },
                callback: function (result) {
                    if (result) {
                        $(itm).parent().parent().remove();
                        $('#stt tbody tr:last-child').remove();
                    }
                }
            });
        }

        function set_destname(value) {
            $('#btnSubmitDialog').data('destname', value);
        }
        function clone_val(src, itm) {
            var dest = $(itm).data('destname');
            var path = $('#' + src).val();
            $.ajax({
                data: { fName: path,id:@ViewBag.Id },
                url: '/QuanLyTinTuc/CopyFile',
                success: function (responsive) {
                    $('#' + dest).val(responsive.newpath);
                }
            });
        }

        function ShowFilter(name, title) {
            $('.filter').each(function () {
                $(this).hide();
            });
            $('#' + name).show();

            $("#divData").html('');
            //$('#title').text(title);
        }

        function filterChilds(itm, childname) {
            var pid = $(itm).val();
            $("#" + childname + " > option").each(function () {
                if (pid == $(this).data("parent")) {
                    $(this).show();
                    $(this).prop("disabled", false);
                } else {
                    $(this).hide();
                    $(this).prop("disabled", true);
                }
            });
            $("#" + childname + " > option").first().prop("disabled", false);
            $("#" + childname).val(0).trigger('change');
            $("#" + childname).select2("destroy");
            $("#" + childname).select2({});
        }


        function submit(type) {
            var values = '';
            $("#ds-lq tbody tr td a").each(function (index) {
                var id = $(this).data('id');
                values += id + ',';

            });


            Cookies.remove('newId2');

            $("#type").val(type);

            if ($('#cates').val() == 0 ||$('#cates').val() == '' || $('#cates').val() == 'undefined') {
                bootbox.alert("Mời bạn chọn chuyên mục!");
                return false;
            }
            if ($('#title').val() == '' || $('#title').val() == 'undefined') {
                bootbox.alert("Tiêu đề không được để trống!");
                return false;
            }
            if ($('#slug').val() == '' || $('#slug').val() == 'undefined') {
                bootbox.alert("Slug không được để trống!");
                return false;
            }
            if ($('#thutu').val() == '' || $('#thutu').val() == 'undefined') {
                bootbox.alert("Mời nhập số thứ tự!");
                return false;
            }
            //if (SapoHople == false) {
            //    bootbox.alert("Sapo nhập vào vượt quá số ký tự cho phép!");
            //    return false;
            //}
            //if (ContentHople == false) {
            //    bootbox.alert("Nội dung nhập vào vượt quá số ký tự cho phép!");
            //    return false;
            //}
            $.ajax({
                data: {
                   // _status: (type == 2) ? 1 : 0,
                    _title: $('#title').val(),
                    _slug: $('#slug').val(),
                    _thumbnail: $('#txt_thumb_url').val(),
                    _sapo: $('#sapo').val(),
                    _content: $('#noidung').summernote('code'),
                    _related: values,
                    _cates: $('#cates').val(),
                    _status: @ViewBag.Infos["Status"],
                    _tags: $('#typeahead_tags').val(),
                    _tags_slug: string_to_slugTag($('#typeahead_tags').val()),
                    _thutu: $('#thutu').val(),
                    _meta_keywords: $('#seo_keywords').val(),
                    _meta_description: $('#seo_description').val(),
                    _typeFile: $('#typeFile').val(),
                    _publishDate:'@ViewBag.Infos["PublishDate"]'
                },
                type: 'POST',
                datatype: 'json',
                url: '/QuanLyTinTuc/Save?id=@ViewBag.Id',
                success: function (responsive) {
                    if (responsive.status) {
                        if (type == 0) {
                            window.location.replace("/QuanLyTinTuc/Index?t=1&cat=" + $('#cates').val() + "&" + "status=@ViewBag.Infos["Status"]" );
                            //window.location.replace("/QuanLyTinTuc/Index?t=1&cat=1000&status=1000");
                        } else if (type == 1) {
                            //catesId
                            console.log('cateId:' + responsive.catesId);
                            $("#cates").val(responsive.catesId)
                            //$("#cates").val($.cookie('catesId'));
                            window.location.replace("/QuanLyTinTuc/Create");
                        } else if (type == 2) {
                            window.location.replace("/QuanLyTinTuc/Edit/" + responsive.newid);
                        }
                        bootbox.alert("Bạn đã lưu thành công");

                    } else {
                        bootbox.alert(responsive.message);
                    }
                },
                error: function (responsive) {
                    console.log(responsive.message);
                }
            });
        }


            toastr.options = {
                "closeButton": true,
                "debug": false,
                "positionClass": "toast-bottom-right",
                "onclick": null,
                "showDuration": "1000",
                "hideDuration": "1000",
                "timeOut": "5000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            //function displaySuccess(message) {
            //    toastr.success(message);
            //}

            //function displayError(error) {
            //        toastr.error(error);
            //}

            //function displayWarning(message) {
            //    toastr.warning(message);
            //}
            //function displayInfo(message) {
            //    toastr.info(message);
            //}

            //return {
            //    displaySuccess: displaySuccess,
            //    displayError: displayError,
            //    displayWarning: displayWarning,
            //    displayInfo: displayInfo
            //}


        function submit_thumbnail_url() {
            if ($('#thumb_url').val() == '') {
                bootbox.confirm({
                    message: "Bạn chắc chắn muốn xóa thumbnail?",
                    buttons: {
                        confirm: {
                            className: 'btn-danger'
                        },
                        cancel: {
                            className: 'btn-success'
                        }
                    },
                    callback: function (result) {
                        if (result == true) {
                            $.ajax({
                                data: {
                                    _thumbnail: $('#thumb_url').val()
                                },
                                type: 'POST',
                                datatype: 'json',
                                url: '/QuanLyTinTuc/SaveThumb?id=@ViewBag.Id',
                                success: function (responsive) {
                                    if (responsive.status)
                                        bootbox.alert("Đã lưu");
                                    else
                                        bootbox.alert(responsive.message);
                                },
                                error: function (responsive) {
                                    bootbox.alert("Có lỗi xảy ra!");
                                }
                            });
                        }
                    }
                });
            } else {
                $.ajax({
                    data: {
                        _thumbnail: $('#thumb_url').val()
                    },
                    type: 'POST',
                    datatype: 'json',
                    url: '/QuanLyTinTuc/SaveThumb?id=@ViewBag.Id',
                    success: function (responsive) {
                        bootbox.alert("Đã lưu");
                    },
                    error: function (responsive) {
                        bootbox.alert("Có lỗi xảy ra!");
                    }
                });
            }
        }

        function submit_configs() {
            $.ajax({
                data: {
                    _status: $('#trang_thai').val(),
                    _show_athome: $('#show_athome').val()
                },
                type: 'POST',
                datatype: 'json',
                url: '/QuanLyTinTuc/UpdateConfig?id=@ViewBag.Id',
                success: function (responsive) {
                    bootbox.alert("Đã cập nhật");
                },
                error: function (responsive) {
                    bootbox.alert("Có lỗi xảy ra!");
                }
            });
        }
        function submit_cachetotalview() {
            $.ajax({
                data: {
                    _view_temp: $('#view_temp').val()
                },
                type: 'POST',
                datatype: 'json',
                url: '/QuanLyTinTuc/CacheViewTemp?id=@ViewBag.Id',
                success: function (responsive) {
                    bootbox.alert("Đã cập nhật");
                },
                error: function (responsive) {
                    bootbox.alert("Có lỗi xảy ra!");
                }
            });
        }

        function isNumberKey(evt) {
            var charCode = (evt.which) ? evt.which : event.keyCode
            if (charCode > 31 && (charCode < 48 || charCode > 57))
                return false;
            return true;
        }
        function update_slug(itm) {
            $('#slug').val(string_to_slug($(itm).val().trim()));
        }
        function string_to_slug(str) {
            str = str.replace(/^\s+|\s+$/g, ''); // trim

            // remove accents, swap ñ for n, etc
            var from = "ÁÄÂÀÃÅČÇĆĎÉĚËÈÊẼĔȆÍÌÎÏŇÑÓÖÒÔÕØŘŔŠŤÚŮÜÙÛÝŸŽáäâàãåčçćďéěëèêẽĕȇíìîïňñóöòôõøðřŕšťúůüùûýÿžþÞĐđßÆa·/_,:;";
            from += "ÁÀẢÃẠáàảãạÂẤẦẨẪẬâấầẩẫậĂẮẰẲẴẶăắằẳẵặĐđÉÈẺẼẸéèẻẽẹÊẾỀỂỄỆêếềểễệÓÒỎÕỌóòỏõọƠỚỜỞỠỢơớờởỡợÔỐỒỔỖỘôốồổỗộÚÙỦŨỤúùủũụƯỨỪỬỮỰưứừửữựÝỲỶỸỴýỳỷỹỵÍÌỈĨỊíìỉĩị";
            var to = "AAAAAACCCDEEEEEEEEIIIINNOOOOOORRSTUUUUUYYZaaaaaacccdeeeeeeeeiiiinnooooooorrstuuuuuyyzbBDdBAa------";
            to += "AAAAAaaaaaAAAAAAaaaaaaAAAAAAaaaaaaDdEEEEEeeeeeEEEEEEeeeeeeOOOOOoooooOOOOOOooooooOOOOOOooooooUUUUUuuuuuUUUUUUuuuuuuYYYYYyyyyyIIIIIiiiii";
            for (var i = 0, l = from.length; i < l; i++) {
                str = str.replace(new RegExp(from.charAt(i), 'g'), to.charAt(i));
            }
            str = str.toLowerCase();

            str = str.replace(/[^a-z0-9 -]/g, '') // remove invalid chars
                .replace(/\s+/g, '-') // collapse whitespace and replace by
                .replace(/-+/g, '-'); // collapse dashes

            return str;
        }
        function string_to_slugTag(str) {
            str = str.replace(/^\s+|\s+$/g, ''); // trim


            // remove accents, swap ñ for n, etc
            var from = "ÁÄÂÀÃÅČÇĆĎÉĚËÈÊẼĔȆÍÌÎÏŇÑÓÖÒÔÕØŘŔŠŤÚŮÜÙÛÝŸŽáäâàãåčçćďéěëèêẽĕȇíìîïňñóöòôõøðřŕšťúůüùûýÿžþÞĐđßÆa·/_:;";
            from += "ÁÀẢÃẠáàảãạÂẤẦẨẪẬâấầẩẫậĂẮẰẲẴẶăắằẳẵặĐđÉÈẺẼẸéèẻẽẹÊẾỀỂỄỆêếềểễệÓÒỎÕỌóòỏõọƠỚỜỞỠỢơớờởỡợÔỐỒỔỖỘôốồổỗộÚÙỦŨỤúùủũụƯỨỪỬỮỰưứừửữựÝỲỶỸỴýỳỷỹỵÍÌỈĨỊíìỉĩị";
            var to = "AAAAAACCCDEEEEEEEEIIIINNOOOOOORRSTUUUUUYYZaaaaaacccdeeeeeeeeiiiinnooooooorrstuuuuuyyzbBDdBAa-----";
            to += "AAAAAaaaaaAAAAAAaaaaaaAAAAAAaaaaaaDdEEEEEeeeeeEEEEEEeeeeeeOOOOOoooooOOOOOOooooooOOOOOOooooooUUUUUuuuuuUUUUUUuuuuuuYYYYYyyyyyIIIIIiiiii";
            for (var i = 0, l = from.length; i < l; i++) {
                str = str.replace(new RegExp(from.charAt(i), 'g'), to.charAt(i));
            }

            str = str.toLowerCase()
                .replace(/\s+/g, '-') // collapse whitespace and replace by
                .replace(/-+/g, '-'); // collapse dashes

            //str = str.replace(/[^a-z0-9 -]/g, '') // remove invalid chars
            //alert(str); return;



            return str;
        }

        //function setusethumbnail(itm) {
        //    $('#thumb_url').val($(itm).attr('src'));
        //    $(itm).addClass('');

        //}

        $(document).ready(function () {
            //$('#title,#slug,#txt_thumb_url,#sapo,#noidung,#thutu').keyup(function(){
            //    isChange = true;
            //});

            $('#trangthai').val('@ViewBag.Infos["Status"]');
            $('#typeFile').val('@ViewBag.Infos["TypeFile"]');
                $('#cboFilter').val('@ViewBag.Infos["CatesId"]');
               $("#cboFilter").select2();
        });
          var load = function () {
              //alert(1);
              var title = $('#txTitle').val();
              var cat = $('#cboFilter').val();
              var table = $("#dsBaiViet tbody");

              $.ajax({
                  data: {
                      id:@ViewBag.Id,
                      title: title,
                      cat: cat
                  },
                  type: 'POST',
                  datatype: 'json',
                  url: '/QuanLyTinTuc/ResultNews',
                  success: function (res) {
                      //response = $.parseJSON(res);
                      //console.log(jQuery.parseJSON(res.data).length);
                     // console.log(res);
                      $('#dsBaiViet tbody').html(res);
                      table.empty();
                      $('#dsBaiViet').DataTable().destroy();
                      table.html(res);
                      $('#dsBaiViet').DataTable({
                          language: {
                              lengthMenu: "Hiển thị _MENU_ bản ghi",
                              search: "Tìm kiếm",
                              info: "Đang ở trang _PAGE_ / _PAGES_ trang",
                              zeroRecords: "Không có bản ghi nào!",
                              infoEmpty: "Không có bản ghi nào!",
                          },
                          retrieve: true,
                          paging: true,
                          searching: false,
                      });
                  },
                  error: function (responsive) {
                      bootbox.alert("Có lỗi xảy ra!");
                  }
              });
          }
          function sortable() {
              $("#sortable").sortable();
              //$("#sortable").disableSelection();
          };
          $('.clockpicker').clockpicker({
              placement: 'bottom',
              align: 'left',
              donetext: 'Chọn',
              'default': 'now',
          }).val(DisplayCurrentTime());

          function DisplayCurrentTime() {
              var date = new Date();
              var hours = date.getHours() > 12 ? date.getHours() - 12 : date.getHours();
              hours = hours < 10 ? "0" + hours : hours;
              var minutes = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
              time = hours + ":" + minutes ;
              //time = hours + ":" + minutes + am_pm;
              return time;
          };
          //function DisplayCurrentTime() {
          //    var date = new Date();
          //    var hours = $('.clockpicker-span-hours').val();
          //    var minutes = $('.clockpicker-span-minutes').val();
          //    time = hours + ":" + minutes;
          //    //time = hours + ":" + minutes + am_pm;
          //    return time;
          //};

          $('.collapse').collapse('hide')
          //function saveSort() {
          //    var values = '';
          //    $("#ds-lq tbody tr").each(function (index) {
          //        var id = $(this).attr('id');
          //        console.log(id);
          //        values += id + ": " + index + ';';

          //    });
          //    alert(values);
          //    $.ajax({
          //        data: {
          //            values: values
          //        },
          //        type: 'POST',
          //        datatype: 'json',
          //        url: '/QuanLyTinTuc/SaveSort',
          //        success: function () {
          //            bootbox.alert("Cập nhật thành công!");
          //        },
          //        error: function (responsive) {
          //            bootbox.alert("Có lỗi xảy ra!");
          //        }
          //    });

          //};
          $('#btn-pop-time').click(function () {
              var now = new Date();
              var month = (now.getMonth() + 1);
              var day = now.getDate();
              if (month < 10)
                  month = "0" + month;
              if (day < 10)
                  day = "0" + day;
              var today = now.getFullYear() + '-' + month + '-' + day;
              $('#pub-date').val(today);
              $('#pop-time').modal('show');  // #myModal (id of modal box)
          });
          function public_news_date (){
                 bootbox.confirm({
                    message: "bạn có muốn công khai bài viết?",
                    buttons: {
                        cancel: {
                            label: 'Không',
                            className: 'btn-info'
                        },
                        confirm: {
                            label: 'Có',
                            className: 'btn-danger'
                        }
                    },
                    callback: function (result) {
                        if (result) {
                            $.ajax({
                                data: { id: @ViewBag.Id },
                                url: '/QuanLyTinTuc/UpdateDatetime',
                                success: function (responsive) {
                                    window.location.replace("/QuanLyTinTuc/Index?t=1&cat=" + $('#cates').val() + "&" + "status=2");

                                }
                            });
                        }
                    }
                });
          }
          function posts_timer() {
              var pubDate = $('#pub-date').val();
              var pubtime = $('#pub-time').val();
              if (pubDate == 0 || pubDate == '' || pubDate == 'undefined') {
                  bootbox.alert("Mời bạn chọn ngày giờ hiển thị!");
                  return false;
              }
              // console.log("date:" + pubDate + ",time:" + pubtime);
              var dateTime = moment(`${pubDate} ${pubtime}`, 'YYYY-MM-DD HH:mm:ss').format();
                             $.ajax({
                                data: {
                                    id: @ViewBag.Id,
                                    _datetime: dateTime
                                },
                                    url: '/QuanLyTinTuc/UpdateDatetime',
                                    success: function (responsive) {
                                        window.location.replace("/QuanLyTinTuc/Index?t=1&cat=" + $('#cates').val() + "&" + "status=2");

                                }
                            });
        }
        function OnCrop(itm) {
            var src = $(itm).data('src');
            //console.log(src);
            //return
            $.ajax({
                data: {
                    src: src,
                },
                type: 'POST',
                datatype: 'json',
                url: '/QuanLyTinTuc/Crop',
                success: function (res) {
                    $('#tab_8').html(res);

                },
                error: function (responsive) {
                    bootbox.alert("Có lỗi xảy ra!");
                }
            });
        }
        //var SapoHople = true;
        //var ContentHople = true;
      var  WordCountSapo = function (obj, objfrom) {
            var str = $(objfrom).val();
            var words = 0;
            str = str.replace(/(^\s*)|(\s*$)/gi, "");//exclude  start and end white-space
            str = str.replace(/[ ]{2,}/gi, " ");//2 or more space to 1
            str = str.replace(/\n /, "\n"); // exclude newline with a start spacing
            words = str.split(' ').length;
          $(obj).html("Hiện có " + words + "/ 120 từ");
          if (words > 120) {
             // SapoHople = false;
              toastr.error("Tóm tắt(Sapo) dường như không tối ưu cho SEO, hãy xem lại!");
              return;
          }

        };
        var WordCountContent = function (obj) {
            var str = $($("#noidung").summernote("code")).text()//$('#noidung').summernote('code');
            var words = 0;
            str = str.replace(/(^\s*)|(\s*$)/gi, "");//exclude  start and end white-space
            str = str.replace(/[ ]{2,}/gi, " ");//2 or more space to 1
            str = str.replace(/\n /, "\n"); // exclude newline with a start spacing
            words = str.split(' ').length;
            $(obj).html("Hiện có " + words + "/ 5000 từ");
            if (words > 5000) {
                //ContentHople = false;
                toastr.error("Nội dung bài viết hơi dài!");
                return;
            }
        };

    </script>
}
@section actionMenu{
    <div class="page-bar">
        <ul class="page-breadcrumb">
            <li> <i class="fa fa-plus icon-home"></i> <i class="fa fa-angle-right"></i> </li>
            <li> <a href="/QuanLyTinTuc">Danh sách</a> <i class="fa fa-angle-right"></i> </li>
            <li> <span>@ViewBag.Title</span> </li>
        </ul>
        <div class="page-toolbar">
            @{

                if (ViewBag.Infos["Status"].ToString() == "2")
                {
                    <a id="quick_view" target="_blank" class="btn btn-success" href="@(Common.GetUrlFrontend()+"/"+ ViewBag.Infos["cate_slug"]+"/"+ViewBag.Infos["Slug"]+".html" )"> <i class="fa fa-eye" aria-hidden="true"></i> Xem trước</a>
                }
                else
                {
                    <a id="quick_view" style="display:none" class="btn btn-success" href="javascript:void(0)"> <i class="fa fa-eye" aria-hidden="true"></i> Xem trước</a>
                }
            }

            <div class="btn-group pull-right">
                <div style="float: left;">

                    <button class="btn btn-info" onclick="submit(1);"><i class="fa fa-save"></i> Lưu, nhập mới</button>
                    <button class="btn btn-primary" onclick="submit(0);"><i class="fa fa-save"></i> Lưu xong đóng</button>
                    <button class="btn btn-success" onclick="submit(2);"><i class="fa fa-save"></i> Lưu</button>
                </div>
                @if (ViewBag.Infos["Status"].ToString() == "1")
                {
                    <div id="box-actions">
                        <button id="btn-pop-time" class="btn btn-info"><i class="fa fa-clock-o"></i> Hẹn giờ xuất bản</button>
                        <button id="btn-pop-public" class="btn btn-info" onclick="public_news_date()"><i class="fa fa-globe"></i> Xuất bản</button>
                    </div>
                }
                @*<button class="btn btn-danger" onclick="submit(2);"><i class="fa fa-save"></i> Công khai</button>*@
            </div>
        </div>
    </div>
}
<style>
    .tabl-attack td {
        padding: 3px 10px;
    }

    .box-left {
        right: 0 !important;
    }

    .box-right {
        left: 0 !important;
        right: 1% !important;
    }
</style>
<div class="row">
    <div class="col-lg-8 col-md-7 col-sm-6 col-lg-pull-4 col-md-pull-5 col-sm-pull-6 box-left">

        <div class="row">
            <div class="portlet box green col-sm-12">
                <div class="portlet-title">
                    <div class="caption">
                        Chuyên mục
                    </div>
                    <div class="tools">
                        <a href="javascript:;" class="collapse" data-original-title="" title=""> </a>

                    </div>
                </div>
                <div class="portlet-body">
                    <div class="form-group ">

                        <select name="cates" id="cates" class="form-control select2" style="width:100%">
                            <option value="0">---Chọn---</option>
                            @if (Model != null)
                            {
                                var items = Model.Where(x => x.idDanhMucCha == 0);
                                foreach (var item in items)
                                {
                                    var childCategory = Model.Where(x => x.idDanhMucCha == item.id);
                                    <option value="@item.id" @(item.id.ToString().Equals(ViewBag.Infos["CatesId"].ToString()) ? " selected " : "")> @item.TenDanhMuc</option>
                                    if (childCategory.Count() > 0)
                                    {
                                        foreach (var child in childCategory)
                                        {
                                            <option value="@child.id" @(child.id.ToString().Equals(ViewBag.Infos["CatesId"].ToString()) ? " selected " : "")> &nbsp;&nbsp;&nbsp; - @child.TenDanhMuc</option>
                                        }
                                    }
                                }
                            }
                        </select>
                    </div>

                </div>

            </div>
            <div class="form-group col-md-12">
                Tên bài viết: <span class="font-red">(*)</span>
                <input name="title" id="title" class="form-control required-nonestyle" onkeyup="update_slug(this);" value="@ViewBag.Infos["Title"]" />
            </div>
            <div class="form-group col-md-12">
                Tóm tắt:<span style="float:right" id="text-warring" class="font-red"></span>
                <textarea name="sapo" id="sapo" onkeyup="WordCountSapo($('#text-warring'),this)" class="form-control" rows="4">@ViewBag.Infos["Summary"]</textarea>
            </div>

            <div class="col-md-12 portlet box green">
                <div class="portlet-title">
                    <div class="caption">
                        Nội dung:
                    </div>

                    <div class="tools">
                        <a href="javascript:;" class="collapse" data-original-title="" title=""> </a>

                    </div>
                    <div id="text-warring-content" class="font-red-thunderbird"></div>
                </div>
                <div class="portlet-body">

                    <div class="form-group ">

                        <textarea name="noidung" id="noidung" class="form-control summernote" rows="4">@ViewBag.Infos["FullContent"]</textarea>
                    </div>

                </div>

            </div>
        </div>
    </div>

    <div class="col-lg-4 col-md-5 col-sm-6 col-lg-push-8 col-md-push-7 col-sm-push-6 box-right">

        @*<div class="form-group col-sm-6">
                Trạng thái:
                <select name="trangthai" id="trangthai" class="form-control">
                    <option value="2">Xuất bản</option>
                    <option value="1">Lưu tạm</option>
                </select>

            </div>*@
        <div class="portlet box green">
            <div class="portlet-title">
                <div class="caption">

                </div>
                <div class="tools">
                    <a href="javascript:;" class="collapse" data-original-title="" title=""> </a>
                    @*<a href="#portlet-config" data-toggle="modal" class="config" data-original-title="" title=""> </a>*@
                </div>
            </div>
            <div class="portlet-body">
                @if (ViewBag.Infos["Status"] == 2)
                {
                    if (Convert.ToDateTime(ViewBag.Infos["PublishDate"]) > DateTime.Now)
                    {
                        <div class="form-group ">
                            Thời điểm bài viết sẽ được hiển thị: <a href="/QuanLyTinTuc/PostNewsCalendar">Xem tất cả</a>
                            <div class="input-group">
                                <div class=" form-control">@ViewBag.Infos["PublishDate"].ToString("HH:mm dd/MM/yyyy") (@(Common.TimeRange(Convert.ToDateTime(ViewBag.Infos["PublishDate"]))))</div>
                                <span class="input-group-btn">
                                    <a id="btn-pop-time" class="btn btn-success"> <i class="fa fa-history fa-fw"></i> </a>
                                </span>
                            </div>
                        </div>
                    }
                }


                <div class="form-group ">
                    Thứ tự hiển thị
                    <input name="Thứ tự" type="number" id="thutu" value="@ViewBag.Infos["SoThuTu"]" class="form-control " />
                </div>
                <div class="form-group">
                    <label>Ảnh avatar:</label>
                    <div class="input-group">
                        <input id="txt_thumb_url" type="text" value="@ViewBag.Infos["Thumbnail"]" class="form-control" placeholder="Đường dẫn đến ảnh">
                        <span class="input-group-btn">
                            <a class="btn btn-success" data-target="#full-width" data-toggle="modal" onclick="set_destname('txt_thumb_url');"> <i class="fa fa-upload fa-fw"></i> </a>
                        </span>
                    </div>
                </div>
                <div class="form-group">
                    <label>File đính kèm:<a class="btn btn-file" data-target="#full-width2" data-toggle="modal" onclick="set_destname('txt_thumb_url2');"> <i class="fa fa-paperclip"></i> </a></label>

                    <table class="tabl-attack table table-striped table-hover table-bordered ">
                        @if (Directory.Exists(ViewBag.FileAttack))
                        {
                            foreach (var files in Directory.GetFiles(ViewBag.FileAttack))
                            {
                                var info = new FileInfo(files);
                                <tr>
                                    <td class="c-file">@Path.GetFileName(info.FullName)</td>
                                    <td class="text-center"><a onclick="removeFile(this)" href="Javascript:void(0)"><i class="fa fa-trash font-red"></i></a></td>
                                </tr>
                            }
                        }

                    </table>
                    <label>Trạng thái hiển thị file:</label>
                    <select name="typeFile" id="typeFile" class="form-control">

                        <option value="1">Mở sẵn</option>
                        <option value="2">Đường link</option>
                    </select>


                </div>
                <div class="form-group">
                    <label>
                        Từ khóa, tags:
                    </label>
                    @{
                        string tags = string.Empty;
                        if (ViewBag.listTag != null)
                        {
                            foreach (DataRow item in ViewBag.listTag.Rows)
                            {
                                tags += item["name"] + ",";
                            }
                        }
                        tags = tags.TrimEnd(',');
                    }
                    <input type="text" data-role="tagsinput" value="@tags" id="typeahead_tags">
                </div>
            </div>

        </div>


        <div class="portlet box green col-sm-12">
            <div class="portlet-title">
                <div class="caption">
                    SEO
                </div>
                <div class="tools">
                    <a href="javascript:;" class="collapse" data-original-title="" title=""> </a>
                    @*<a href="#portlet-config" data-toggle="modal" class="config" data-original-title="" title=""> </a>*@
                </div>
            </div>
            <div class="portlet-body">
                <div class="form-group">
                    Slug: <span class="font-red">(*)</span>
                    <input name="slug" id="slug" class="form-control required-nonestyle" value="@ViewBag.Infos["Slug"]" />
                </div>
                <div class="form-group">
                    Meta-keywords:
                    <input type="text" value="@ViewBag.Infos["meta_keywords"]" id="seo_keywords">
                </div>
                <div class="form-group">
                    Meta-description:
                    <input type="text" class="form-control" value="@ViewBag.Infos["meta_descriptions"]" id="seo_description">
                </div>
            </div>
        </div>

        <div class="portlet box green col-sm-12">
            <div class="portlet-title">
                <div class="caption">
                    Bài liên quan:
                </div>
                <div class="tools">
                    <a href="javascript:;" class="collapse" data-original-title="" title=""> </a>
                    <a href="" class="fullscreen" data-original-title="" title=""> </a>
                    <a href="#portlet-config" data-toggle="modal" class="config" data-original-title="" title="" style="display: none;"></a>
                </div>
                <div class="actions">
                    <a id="btnSearch1" class="btn btn-success" data-target="#full-width3" data-toggle="modal"> <i class="fa fa-plus fa-fw"></i> Thêm bài</a>
                </div>
            </div>
            <div class="portlet-body">
                <div class="d-flex flex-nowrap" style="display:inline-flex">
                    @*<table class=" table table-striped table-hover table-bordered" id="stt">
                            @if (ViewBag.DsLienQuan.Rows != null)
                            {
                                <thead>
                                    <tr>
                                        <th class="text-center" style="width:15px!important;">STT</th>
                                    </tr>
                                </thead>
                                <tbody id="tStt">
                                    @{int stt = 0;}
                                    @foreach (DataRow item in ViewBag.DsLienQuan.Rows)
                                    {
                                        stt++;

                                        <tr>
                                            <td class="text-center">@stt</td>
                                        </tr>

                                    }
                                </tbody>
                            }

                        </table>*@

                    <table class=" table table-striped table-hover table-bordered " id="ds-lq">
                        @if (ViewBag.DsLienQuan.Rows != null)
                        {
                            <thead>
                                <tr>
                                    <th class="text-center" style="width:15px!important;">STT</th>
                                    <th style="width:400px">Tên bài viết</th>
                                    <th class="text-center" style="width: 100px!important;">#</th>
                                </tr>
                            </thead>
                            <tbody id="sortable">
                                @{int stt = 0; }
                                @foreach (DataRow item in ViewBag.DsLienQuan.Rows)
                                {
                                    stt++;

                                    <tr id="@item["RelatedId"]">
                                        <td class="tStt text-center">@stt</td>
                                        <td class="">@item["Title"]</td>
                                        <td class="text-center"><a class="remove-new" data-id="@item["RelatedId"]" onclick="removeNews(this)" href="Javascript:void(0)"><i class="fa fa-trash font-red"></i></a></td>
                                    </tr>

                                }
                            </tbody>
                        }

                    </table>
                </div>
            </div>
        </div>


        @*<a href="@Url.Action("Edit", "QuanLyTinTuc", new { id = ViewBag.Id, isHistory = true })">Lấy dữ liệu</a>*@
        @*<span>
                <a target="_blank" onclick="getdataNewhistory()" class="btn btn-success" href="Javascript:void(0)"> <i class="fa fa-eye" aria-hidden="true"></i>GetData </a>
            </span>*@
    </div>
</div>
<!-- full width -->
<div id="full-width" class="modal container fade" tabindex="-1">

    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
        <h4 class="modal-title">Chọn ảnh</h4>
    </div>
    <div class="modal-body">
        <div class="form-group">
            <label>Đường dẫn ảnh vừa chọn</label>
            <input type="text" id="thumb_url" class="form-control" placeholder="Đường dẫn đến ảnh" value="">
        </div>
        <div class="col-sm-6">
            @*<b><u>Lưu ý:</u></b> Sau khi upload xong, cần bấm F5 để ảnh hiển thị ở cột bên cạnh*@
            <div class="dropzone needsclick dz-clickable" id="frm_dropzone">
                <div class="dz-message needsclick">
                    <h3 class="sbold">Thả hình, ảnh vào đây</h3><br>
                    <span class="note needsclick">Các hình, ảnh chụp về bài viết<br />(dung lượng tối đa: 4MB)</span>
                </div>
            </div>

        </div>
        <div class="col-sm-6 item-img ">
            <div class="row">
                @if (Directory.Exists(ViewBag.Images))
                {
                    foreach (var files in Directory.GetFiles(ViewBag.Images))
                    {
                        var info = new FileInfo(files);
                        <div class=" col-md-3" style="height:80px;padding-top:5px;padding-bottom:5px;margin-top:5px;margin-bottom:5px;">
                            <div style="height:80px;width:120px; cursor:pointer;position:relative;display: inline!important">
                                <i onclick="removeImg(this)" class="fa fa-times btn_remove" aria-hidden="true"></i>

                                <div class="dz-preview dz-processing dz-image-preview dz-success dz-complete">
                                    <img id="img_id_@Path.GetFileName(info.FullName)" onclick="setusethumbnail(this)" style="max-height:80px;max-width:120px;cursor:pointer;" data-dz-thumbnail="" alt="@Path.GetFileName(info.FullName)" src='/UserData/@ViewBag.userId/@ViewBag.Id/@Path.GetFileName(info.FullName)'>
                                </div>
                            </div>
                        </div>
                    }
                }
            </div>
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="modal-footer">
        @*<span id="pop-crop" style="display:none" class="input-group-btn">
                <a id="pop-crop-1" class="btn btn-success" data-target="#full-width4" data-src="" data-toggle="modal" onclick="OnCrop(this)"> <i class="fa fa-upload fa-fw"></i> </a>
            </span>*@

        <button type="button" data-dismiss="modal" class="btn btn-outline dark">Thôi</button>
        <button id="pop-crop-1" style="display:none" data-target="#full-width4" type="button" data-toggle="modal" onclick="OnCrop(this)" class="btn green">Cắt ảnh</button>

        <button type="button" data-dismiss="modal" class="btn green" id="btnSubmitDialog" data-destname="" onclick="clone_val('thumb_url', this)">Sử dụng hình ảnh</button>
    </div>
</div>


<div id="full-width2" class="modal container fade" tabindex="-1">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
        <h4 class="modal-title">Chọn File</h4>
    </div>
    <div class="modal-body">
        <div class="form-group">
            <label>Đường dẫn File vừa chọn</label>
            <input type="text" id="thumb_url2" class="form-control" placeholder="Đường dẫn đến ảnh" value="">
        </div>
        <div class="col-sm-12">
            <div class="dropzone needsclick dz-clickable" id="frm_dropzone2">
                <div class="dz-message needsclick">
                    <h3 class="sbold">Thả/ chọn file vào đây</h3><br>
                    <span class="note needsclick">Các File <br />(dung lượng tối đa: 12MB)</span>
                </div>
            </div>
        </div>

        <div class="clearfix"></div>
    </div>
</div>

<div id="full-width3" class="modal container fade" tabindex="-1">
    <script>
        function ClonePath(itm) {
            var title = $(itm).data("title");
            var exist = false;
            var id = $(itm).data("id");
            //console.log(id);
            $(".remove-new").each(function () {
                //console.log(id);
                if (id == $(this).data("id")) {
                    exist = true;
                    return false;
                }
            });
            console.log(exist);
            if (exist) {
                bootbox.alert("Đã có bài viết cùng tiêu đề");
            } else {
                var index = $('.tStt').last().text();
                console.log(index);
                if (typeof (index) == 'undefined' || index == null || index == '') {
                    index = '0';
                }
                //var tableStt = '';
                //tableStt += '<tr>'
                //    + ' <td class="text-center">' + (parseInt(index) + 1) + '</td>'
                //    + '</tr>';
                //$('#stt').append(tableStt);

                var html = '';
                html += '<tr>'
                    + ' <td class="tStt text-center">' + (parseInt(index) + 1) + '</td>'
                    + '<td >' + title + '</td>'
                    + '<td class="text-center"><a class="remove-new" data-id = "' + id + '" onclick="removeNews(this)" href="Javascript:void(0)"><i class="fa fa-trash font-red"></i></a></td>'
                    + '</tr>';
                $('#ds-lq').append(html);
            }

        }
    </script>
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
        <h4 class="modal-title">Chọn bài</h4>
    </div>
    <div class="modal-body">
        <div class="form-group">

            @*<input type="hidden" id="news_url" class="form-control" placeholder="Đường dẫn đến ảnh" value="">*@
            <div class="row">
                <div class="col-md-3">
                    <div>Chọn chuyên mục:</div>
                    <select name="cates" id="cboFilter" class="form-control" style="width:100%">
                        <option value="0">---Tất cả---</option>
                        @if (Model != null)
                        {
                            var items = Model.Where(x => x.idDanhMucCha == 0);
                            foreach (var item in items)
                            {
                                var childCategory = Model.Where(x => x.idDanhMucCha == item.id);
                                <option value="@item.id" @(ViewBag.CatId == item.id.MapInt() ? " selected" : "")> @item.TenDanhMuc</option>
                                if (childCategory.Count() > 0)
                                {
                                    foreach (var child in childCategory)
                                    {
                                        <option value="@child.id" @(ViewBag.CatId == child.id.MapInt() ? " selected" : "")> &nbsp;&nbsp;&nbsp; - @child.TenDanhMuc</option>
                                    }
                                }
                            }
                        }
                    </select>
                </div>

                <div class="col-md-3">
                    <div class="form-group">
                        Tiêu đề:
                        <input id="txTitle" class="form-control " />
                    </div>
                </div>
                <div class="col-md-2">
                    &nbsp;
                    <div class="form-group">
                        <button id="btnSearch" class="btn btn-fit-height btn-primary"><i class="fa fa-search" aria-hidden="true"></i> Tìm kiếm </button>
                    </div>
                </div>

            </div>
            <div class="table-scrollable cover-table">
                <table class="table table-striped table-hover table-bordered" id="dsBaiViet">
                    <thead>
                        <tr>
                            <th class="text-center" style="width:15px!important;">STT</th>
                            <th style="width:400px">Tên bài viết</th>
                            <th class="text-center" style="width: 100px!important;">#</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>

            </div>
        </div>

        <div class="clearfix"></div>
    </div>
    <div class="modal-footer">
        <button type="button" data-dismiss="modal" class="btn btn-outline dark">Thôi</button>
        @*<button type="button" data-dismiss="modal" class="btn green" id="btnSubmitDialog2" data-destname="" onclick="clone_new_url('news_url', this)">Sử dụng bài viết</button>*@
    </div>
</div>


<div id="pop-time" class="modal fade" tabindex="-1">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
        <h4 class="modal-title">  Thời gian hiển thị:</h4>

    </div>
    <div class="modal-body">
        <div class="col-sm-12">
            Hiển thị lúc:
            <div class="row">
                <div class="col-sm-6">
                    <input @*value="@Convert.ToDateTime(ViewBag.Infos["PublishDate"]).ToString("HH:mm")"*@ id="pub-time" class="col-sm-6 form-control clockpicker js-input-time" type="text" name="pub-time" required>
                </div>
                <div class="col-sm-6">
                    <input type="date" class="col-sm-6 form-control hasDatepicker date-picker" name="to" id="pub-date" required />
                </div>
            </div>
        </div>

        <div class="clearfix"></div>
    </div>
    <div class="modal-footer">
        <button type="button" data-dismiss="modal" class="btn green" data-destname="" onclick="posts_timer()">Đăng</button>
    </div>
</div>
<div id="full-width4" class="modal container fade" tabindex="-1">

    <div class="modal-body">
        <div class="col-sm-12">
            <div class="tab-pane" id="tab_8">

            </div>
        </div>

        <div class="clearfix"></div>
    </div>
</div>



